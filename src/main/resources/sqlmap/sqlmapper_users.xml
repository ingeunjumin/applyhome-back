<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- MyBatis에게 Mapper 경로를 적어야 한다. -->
<mapper namespace="com.ingeunjumin.project.mapper.UsersMapper">
	
	<!-- 사용자 조회 -->
	<select id="selectUserInfo" resultType="UsersVO">
        SELECT
            user_no AS userNo,
            user_password AS userPassword,
            user_id AS userId ,
            user_name AS name,
            phone,
            email
        FROM users
        WHERE user_id = #{userId}
    </select>
    
    <!-- 사용자 권한 조회 -->
    <select id="selectUserAuth" resultType="AuthorityVO">
		SELECT
            a.role_id AS id,
            a.role_name AS roleCode,
            a.role_description AS roleDescription
        FROM users AS u
        INNER JOIN auth_users_authority AS au
        	ON au.user_no = u.user_no 
        INNER JOIN auth_authority as a
        	ON a.role_id = au.role_id
        WHERE user_id = #{userId}
	</select>
    
    <!-- 전체 사용자 조회 -->
    <select id="selectUsersAll" resultType="UsersVO">
        SELECT
            user_no AS userNo,
            user_password AS userPassword,
            user_id AS userId ,
            user_name AS userName,
            phone,
            email
        FROM users
    </select>
    
    <!-- 사용자 추가 -->
	<insert id="insertUser">
		INSERT INTO users
		(
			user_id,
			user_password,
			user_name,
			phone,
			email	
		)
		VALUES
		(
			#{userId},
			#{userPassword},
			#{name},
			#{phone},
			#{email}
		)
	</insert>
	
    <!-- 특정 사용자 삭제 -->
    <delete id="deleteUser">
	DELETE 
		FROM users
	WHERE 
		user_no = #{userNo}
	</delete>
	
	<!-- 특정 사용자 업데이트 -->
	<!-- 
		- prifix = tirm 안에있는 모든 문자열의 앞에 붙여줄 문자열을 입력하는 곳
		- suffixOverrides = trim 안에있는 모든 문자열의 조건문을 판별해서 입력된 문자열의 맨 끝에서부터 찾아서 지워줄 문자열을 입력하는 곳 
	-->
	<update id="updateUser">
	UPDATE users
	<trim prefix="SET" suffixOverrides=",">
	<if test="userId != null">userId = #{userId},</if>
	<if test="userPassword != null">userPassword = #{userPassword},</if>
	<if test="userName != null">userName = #{userName},</if>
	<if test="phone != null">phone = #{phone},</if>
	<if test="email != null">email = #{email},</if>
	<if test="auth != null">auth = #{auth},</if>
	</trim>
	WHERE user_no = #{userNo}
	</update>
    
</mapper>