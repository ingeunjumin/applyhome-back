<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- API 전용 sql -->
<mapper namespace="com.ingeunjumin.project.api.ApiMapper">

    <select id="selectAllApartments" resultType="map">
	    SELECT 
			apartments_no AS apartmentsNo,
			apartments_name AS apartmentsName, 
			latitude,
			longitude
		FROM apartments 
    </select>
    
    <select id="selectAllApartmentsAndBusinessArea" resultType="map">
    	
    </select>
    
    
   	<select id="selectOneApartments" resultType="map">
   		SELECT 
			apartments_no AS apartmentsNo,
			apartments_name AS apartmentsName,
			price,
			addr,
			gu,
			dong,
			DATE_FORMAT(create_at, '%Y-%m-%d') AS createAt
		FROM apartments 
		WHERE apartments_no = #{apartmentsNo}
   	</select>
    
    <select id="selectApartmentsContract" resultType="map">
    	SELECT 
			a.apartments_no AS apartmentsNo,
			a.apartments_name AS apartmentsName,
			AVG(hs.sale_price) AS salePrice,
			FORMAT(AVG(hs.sale_price),0) AS salePriceComma,
			hs.gu,
			hs.dong,
			hs.floor,
			hs.area_for_exclusive_use AS areaForExclusiveUse,
			DATE_FORMAT(hs.create_at, '%Y-%m-%d') AS createAt
		FROM apartments AS a
		INNER JOIN history_sale_contract AS hs
		ON a.apartments_no = hs.apartments_no 
		WHERE a.apartments_no = #{apartmentsNo}
		AND DATE_FORMAT(hs.create_at,'%Y-%m-%d') >= #{date}
		GROUP BY DATE_FORMAT(hs.create_at,'%Y-%m-%d')
		ORDER BY hs.create_at DESC
    </select>
 
	<select id="selectBusinessArea" resultType="map">
		SELECT
			business_type AS businessType,
			business_name AS businessName,
			latitude,
			longitude
		FROM business_area
	</select>
    
</mapper>